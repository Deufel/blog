<!DOCTYPE html>
<html>
<head>
    <script type="module" src="https://cdn.jsdelivr.net/gh/starfederation/datastar@main/bundles/datastar.js"></script>
    <style>
        .tab-container {
            font-family: system-ui, sans-serif;
            max-width: 800px;
            margin: 2rem auto;
            padding: 1rem;
        }

        [role="tablist"] {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
            border-bottom: 1px solid #e5e5e5;
        }

        [role="tab"] {
            padding: 0.75rem 1rem;
            border: none;
            background: transparent;
            cursor: pointer;
            border-radius: 0.375rem 0.375rem 0 0;
            transition: all 0.2s;
        }

        [role="tab"]:hover {
            background: #f3f4f6;
        }

        [role="tab"][aria-selected="true"] {
            background: #3b82f6;
            color: white;
        }

        [role="tab"]:focus {
            outline: 2px solid #3b82f6;
            outline-offset: 2px;
        }

        .content-area {
            min-height: 200px;
            padding: 1rem;
            border: 1px solid #e5e5e5;
            border-radius: 0.375rem;
        }

        .keyboard-help {
            margin-top: 1rem;
            padding: 1rem;
            background: #f9fafb;
            border-radius: 0.375rem;
            font-size: 0.875rem;
        }

        .keyboard-help kbd {
            background: #374151;
            color: white;
            padding: 0.125rem 0.25rem;
            border-radius: 0.25rem;
            font-family: monospace;
            font-size: 0.75rem;
        }
    </style>
</head>
<body>
    <div class="tab-container">
        <div role="tablist"
             aria-label="CSS Action Component Examples"
             data-signals="{
                 currentTab: 'button',
                 tabs: ['button', 'button-group', 'icon-button', 'toggle-button'],
                 lastKeyTime: 0,
                 lastKey: ''
             }"
             data-computed-currentTabIndex="$tabs.indexOf($currentTab)"
             data-on-keydown__window="
                 // Only handle if focus is on a tab
                 if (!evt.target.matches('[role=tab]')) return;

                 const now = Date.now();
                 let handled = false;
                 let newIndex = $currentTabIndex;

                 // Handle 'g' key sequences for vim-like navigation
                 if (evt.key === 'g') {
                     if ($lastKey === 'g' && (now - $lastKeyTime) < 500) {
                         // 'gg' - go to first tab
                         newIndex = 0;
                         handled = true;
                         $lastKey = ''; // Reset to prevent triple 'g'
                     } else {
                         // First 'g' - just record it
                         $lastKey = 'g';
                         $lastKeyTime = now;
                         evt.preventDefault();
                         return;
                     }
                 } else if (evt.key === 'G') {
                     // 'G' - go to last tab
                     newIndex = $tabs.length - 1;
                     handled = true;
                     $lastKey = '';
                 } else {
                     // Reset g sequence for any other key
                     $lastKey = '';

                     // Handle arrow keys and vim-style navigation
                     if (evt.key === 'ArrowLeft' || evt.key === 'h') {
                         newIndex = ($currentTabIndex - 1 + $tabs.length) % $tabs.length;
                         handled = true;
                     } else if (evt.key === 'ArrowRight' || evt.key === 'l') {
                         newIndex = ($currentTabIndex + 1) % $tabs.length;
                         handled = true;
                     } else if (evt.key === 'k') {
                         newIndex = ($currentTabIndex - 1 + $tabs.length) % $tabs.length;
                         handled = true;
                     } else if (evt.key === 'j') {
                         newIndex = ($currentTabIndex + 1) % $tabs.length;
                         handled = true;
                     }
                 }

                 if (handled) {
                     evt.preventDefault();
                     $currentTab = $tabs[newIndex];
                     $lastKeyTime = now;

                     // Use setTimeout to ensure DOM updates before focusing
                     setTimeout(() => {
                         const targetTab = document.getElementById($tabs[newIndex]);
                         if (targetTab) {
                             targetTab.focus();
                         }
                     }, 0);
                 }
             ">

            <button id="button" role="tab"
                data-attr-aria-selected="$currentTab === 'button' ? 'true' : null"
                data-attr-tabindex="$currentTab === 'button' ? '0' : '-1'"
                data-on-click="$currentTab = 'button'"
            >
                Button
            </button>

            <button id="button-group" role="tab"
                data-attr-aria-selected="$currentTab === 'button-group' ? 'true' : null"
                data-attr-tabindex="$currentTab === 'button-group' ? '0' : '-1'"
                data-on-click="$currentTab = 'button-group'"
            >
                Button Group
            </button>

            <button id="icon-button" role="tab"
                data-attr-aria-selected="$currentTab === 'icon-button' ? 'true' : null"
                data-attr-tabindex="$currentTab === 'icon-button' ? '0' : '-1'"
                data-on-click="$currentTab = 'icon-button'"
            >
                Icon Button
            </button>

            <button id="toggle-button" role="tab"
                data-attr-aria-selected="$currentTab === 'toggle-button' ? 'true' : null"
                data-attr-tabindex="$currentTab === 'toggle-button' ? '0' : '-1'"
                data-on-click="$currentTab = 'toggle-button'"
            >
                Toggle Button
            </button>
        </div>

        <div class="content-area">
            <div data-show="$currentTab === 'button'">
                <h3>Button Component</h3>
                <p>Standard button implementation with various states and styles.</p>
            </div>
            <div data-show="$currentTab === 'button-group'">
                <h3>Button Group Component</h3>
                <p>Grouped buttons for related actions or toggle selections.</p>
            </div>
            <div data-show="$currentTab === 'icon-button'">
                <h3>Icon Button Component</h3>
                <p>Compact buttons with icon representations for space-efficient interfaces.</p>
            </div>
            <div data-show="$currentTab === 'toggle-button'">
                <h3>Toggle Button Component</h3>
                <p>Stateful buttons that can be pressed/unpressed for binary selections.</p>
            </div>
        </div>

        <div class="keyboard-help">
            <strong>Keyboard Navigation:</strong><br>
            <kbd>←</kbd> <kbd>→</kbd> <kbd>h</kbd> <kbd>l</kbd> <kbd>j</kbd> <kbd>k</kbd> - Navigate between tabs<br>
            <kbd>g</kbd><kbd>g</kbd> - Go to first tab<br>
            <kbd>G</kbd> - Go to last tab
        </div>

        <div style="margin-top: 1rem; font-size: 0.875rem; color: #6b7280;">
            Current tab: <span data-text="$currentTab"></span> |
            Index: <span data-text="$currentTabIndex"></span> |
            Last key: <span data-text="$lastKey"></span>
        </div>
    </div>
</body>
</html>
