<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Datastar Theme System</title>
    <script type="module" src="https://cdn.jsdelivr.net/gh/starfederation/datastar@main/bundles/datastar.js"></script>
    <style>
        :root {
            --oklch-cyan: 200deg;
            --oklch-blue: 240deg;
            --oklch-green: 120deg;
            --oklch-red: 0deg;
            --oklch-purple: 280deg;
            --oklch-orange: 30deg;
        }

        [data-theme="light"] {
            --bg-color: oklch(98% 0.02 var(--palette-hue, var(--oklch-cyan)));
            --text-color: oklch(20% 0.02 var(--palette-hue, var(--oklch-cyan)));
            --accent-color: oklch(60% 0.15 var(--palette-hue, var(--oklch-cyan)));
        }

        [data-theme="dark"] {
            --bg-color: oklch(15% 0.02 var(--palette-hue, var(--oklch-cyan)));
            --text-color: oklch(90% 0.02 var(--palette-hue, var(--oklch-cyan)));
            --accent-color: oklch(70% 0.15 var(--palette-hue, var(--oklch-cyan)));
        }

        [data-theme="system"] {
            --bg-color: light-dark(
                oklch(98% 0.02 var(--palette-hue, var(--oklch-cyan))),
                oklch(15% 0.02 var(--palette-hue, var(--oklch-cyan)))
            );
            --text-color: light-dark(
                oklch(20% 0.02 var(--palette-hue, var(--oklch-cyan))),
                oklch(90% 0.02 var(--palette-hue, var(--oklch-cyan)))
            );
            --accent-color: light-dark(
                oklch(60% 0.15 var(--palette-hue, var(--oklch-cyan))),
                oklch(70% 0.15 var(--palette-hue, var(--oklch-cyan)))
            );
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: system-ui, -apple-system, sans-serif;
            margin: 0;
            padding: 2rem;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        .theme-controls {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .control-group h3 {
            margin: 0;
            font-size: 1rem;
            font-weight: 600;
        }

        .button-group {
            display: flex;
            gap: 0.25rem;
            border: 1px solid var(--accent-color);
            border-radius: 0.5rem;
            overflow: hidden;
        }

        .theme-btn {
            padding: 0.5rem 1rem;
            background: transparent;
            border: none;
            color: var(--text-color);
            cursor: pointer;
            transition: all 0.2s ease;
            border-right: 1px solid var(--accent-color);
        }

        .theme-btn:last-child {
            border-right: none;
        }

        .theme-btn:hover {
            background-color: var(--accent-color);
            opacity: 0.7;
        }

        .theme-btn.selected {
            background-color: var(--accent-color);
            font-weight: 600;
        }

        .color-btn {
            width: 2.5rem;
            height: 2.5rem;
            border: 2px solid var(--text-color);
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
        }

        .color-btn:hover {
            transform: scale(1.1);
        }

        .color-btn.selected {
            border-width: 3px;
            transform: scale(1.1);
        }

        .color-btn.selected::after {
            content: "âœ“";
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: var(--text-color);
            font-weight: bold;
            font-size: 0.8rem;
        }

        .cyan { background-color: oklch(60% 0.15 var(--oklch-cyan)); }
        .blue { background-color: oklch(60% 0.15 var(--oklch-blue)); }
        .green { background-color: oklch(60% 0.15 var(--oklch-green)); }
        .red { background-color: oklch(60% 0.15 var(--oklch-red)); }
        .purple { background-color: oklch(60% 0.15 var(--oklch-purple)); }
        .orange { background-color: oklch(60% 0.15 var(--oklch-orange)); }

        .demo-content {
            max-width: 800px;
        }

        .demo-content h1 {
            color: var(--accent-color);
        }

        .demo-content p {
            line-height: 1.6;
            margin-bottom: 1rem;
        }

        .card {
            background: var(--accent-color);
            opacity: 0.1;
            padding: 1.5rem;
            border-radius: 0.5rem;
            margin: 1rem 0;
        }

        .broadcast-status {
            position: fixed;
            top: 1rem;
            right: 1rem;
            padding: 0.5rem 1rem;
            background: var(--accent-color);
            color: var(--bg-color);
            border-radius: 0.25rem;
            font-size: 0.8rem;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .broadcast-status.show {
            opacity: 1;
        }
    </style>
</head>
<body
    data-signals="{
        themeMode: 'system',
        colorHue: 'cyan',
        broadcastMessage: ''
    }"
    data-persist="{include: /^(themeMode|colorHue)$/}"
    data-effect="
        document.documentElement.setAttribute('data-theme', $themeMode);
        document.documentElement.style.setProperty('--palette-hue', 'var(--oklch-' + $colorHue + ')');
    "
    data-on-load="
        const bc = new BroadcastChannel('theme-updates');
        bc.onmessage = (e) => {
            if (e.data.type === 'theme-change') {
                $themeMode = e.data.themeMode || $themeMode;
                $colorHue = e.data.colorHue || $colorHue;
                $broadcastMessage = 'Theme synced from another tab';
                setTimeout(() => $broadcastMessage = '', 2000);
            }
        };
        window.themeBroadcast = bc;
    "
>
    <!-- Broadcast status indicator -->
    <div
        class="broadcast-status"
        data-class-show="$broadcastMessage !== ''"
        data-text="$broadcastMessage"
    ></div>

    <div class="theme-controls">
        <div class="control-group">
            <h3>Theme Mode</h3>
            <div class="button-group" id="theme-toggle">
                <button
                    class="theme-btn"
                    data-class-selected="$themeMode === 'light'"
                    data-on-click="
                        $themeMode = 'light';
                        window.themeBroadcast?.postMessage({
                            type: 'theme-change',
                            themeMode: 'light',
                            colorHue: $colorHue
                        });
                    "
                >
                    Light
                </button>
                <button
                    class="theme-btn"
                    data-class-selected="$themeMode === 'dark'"
                    data-on-click="
                        $themeMode = 'dark';
                        window.themeBroadcast?.postMessage({
                            type: 'theme-change',
                            themeMode: 'dark',
                            colorHue: $colorHue
                        });
                    "
                >
                    Dark
                </button>
                <button
                    class="theme-btn"
                    data-class-selected="$themeMode === 'system'"
                    data-on-click="
                        $themeMode = 'system';
                        window.themeBroadcast?.postMessage({
                            type: 'theme-change',
                            themeMode: 'system',
                            colorHue: $colorHue
                        });
                    "
                >
                    System
                </button>
            </div>
        </div>

        <div class="control-group">
            <h3>Color Hue</h3>
            <div class="button-group" id="color-toggle">
                <button
                    class="color-btn cyan"
                    data-class-selected="$colorHue === 'cyan'"
                    data-on-click="
                        $colorHue = 'cyan';
                        window.themeBroadcast?.postMessage({
                            type: 'theme-change',
                            themeMode: $themeMode,
                            colorHue: 'cyan'
                        });
                    "
                    title="Cyan"
                ></button>
                <button
                    class="color-btn blue"
                    data-class-selected="$colorHue === 'blue'"
                    data-on-click="
                        $colorHue = 'blue';
                        window.themeBroadcast?.postMessage({
                            type: 'theme-change',
                            themeMode: $themeMode,
                            colorHue: 'blue'
                        });
                    "
                    title="Blue"
                ></button>
                <button
                    class="color-btn green"
                    data-class-selected="$colorHue === 'green'"
                    data-on-click="
                        $colorHue = 'green';
                        window.themeBroadcast?.postMessage({
                            type: 'theme-change',
                            themeMode: $themeMode,
                            colorHue: 'green'
                        });
                    "
                    title="Green"
                ></button>
                <button
                    class="color-btn red"
                    data-class-selected="$colorHue === 'red'"
                    data-on-click="
                        $colorHue = 'red';
                        window.themeBroadcast?.postMessage({
                            type: 'theme-change',
                            themeMode: $themeMode,
                            colorHue: 'red'
                        });
                    "
                    title="Red"
                ></button>
                <button
                    class="color-btn purple"
                    data-class-selected="$colorHue === 'purple'"
                    data-on-click="
                        $colorHue = 'purple';
                        window.themeBroadcast?.postMessage({
                            type: 'theme-change',
                            themeMode: $themeMode,
                            colorHue: 'purple'
                        });
                    "
                    title="Purple"
                ></button>
                <button
                    class="color-btn orange"
                    data-class-selected="$colorHue === 'orange'"
                    data-on-click="
                        $colorHue = 'orange';
                        window.themeBroadcast?.postMessage({
                            type: 'theme-change',
                            themeMode: $themeMode,
                            colorHue: 'orange'
                        });
                    "
                    title="Orange"
                ></button>
            </div>
        </div>
    </div>

    <div class="demo-content">
        <h1>Datastar Theme System</h1>
        <p>
            This theme system is built entirely with Datastar attributes, replacing the original JavaScript with declarative data attributes. The theme preferences are automatically persisted to localStorage and synchronized across browser tabs via BroadcastChannel.
        </p>

        <div class="card">
            <h3>Key Features:</h3>
            <ul>
                <li><strong>Reactive UI:</strong> Button states update automatically using <code>data-class-selected</code></li>
                <li><strong>Persistent Storage:</strong> Theme preferences saved with <code>data-persist</code></li>
                <li><strong>Tab Synchronization:</strong> Changes broadcast across tabs in real-time</li>
                <li><strong>CSS Custom Properties:</strong> Theme applied via <code>data-effect</code></li>
                <li><strong>No Manual DOM Manipulation:</strong> All UI updates handled declaratively</li>
            </ul>
        </div>

        <p>
            Current theme: <strong data-text="$themeMode"></strong> with <strong data-text="$colorHue"></strong> hue.
        </p>

        <p>
            Try opening this page in multiple tabs and changing the theme - you'll see the changes sync across all tabs instantly!
        </p>
    </div>
</body>
</html>
